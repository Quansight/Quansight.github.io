---
layout: post
title: Episode 14 - ITK - Open Source Directions
---

<iframe width="560" height="315" src="https://www.youtube.com/embed/o_X-4EbLolY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

### Introductions

Welcome to Open Source Directions, the webinar that informs you about the future of open source projects.
This episode, the project being highlighted is the Insight Segmentation and Registration Toolkit or [ITK](https://itk.org/)

* **Host:** Anthony Scopatz
* **Co-Host:** David Charboneau
* **Guest 1:** Matt McCormick: has been involved in the ITK community for over ten years, since he worked on his PhD thesis in ultrasound imaging. He works at Kitware, a collaborative, open source scientific consulting company.
* **Guest 2:** Beatriz Paniagua: She also works at Kitware in Carrboro, North Carolina, and she specializes in craniofacial and musculoskeletal applications and software.

### Project Overview

The Insight Segmentation and Registration Toolkit (ITK) is an open-source, cross-platform system that provides developers with an extensive suite of software tools for image analysis. It stands at 729,000 downloads from Sourceforge.net as of February 2019.  The project's recent migration to GitHub, PyPI, and conda is an exciting new development, and it has 432 stars on Github at the moment.

ITK was started to provide software capable of analyzing data generated by the Visible Human Project. The Visible Human Project was an ambitious endeavor to generate a detailed, complete 3D volumetric dataset of human anatomy. Thin, cross-sectional, high resolution photographs were collected along with magnetic resonance images and x-ray computed tomography images on both a female and male cadaver. Visible Human project planning began at the U.S. National Library of Medicine in 1986; the male dataset was completed in 1994 and the female in 1995.  ITK began in 1999 with support from the National Library of Medicine to provide advanced computational algorithms in high-quality, open source software. The project was motivated by image analysis code being hidden away in research lab, and it was often neither re-usable or reproducible. There was a desire to do advanced image analysis research, but they had to produce open source software which they could use and which would make an impact.

ITK is one of the most widely used libraries for image analysis.  ITK's origins are in medical image analysis, and the open source toolkit is widely used by medical imaging researchers and medical imaging device developers. However, the toolkit is applied in domains beyond medical imaging today, including microscopy and remote sensing applications. ITK's use spans any application where we wish to obtain quantitative insights from images.  ITK's main strengths are the N-dimensional, high-performance implementations of advanced algorithms. This includes registration and segmentation algorithms. Registration is the task of finding the spatial transformation that aligns two images. Segmentation identifies or classifies pixels in an image.

There are alternative project to ITK out there. Proprietary tools are available such as Matlab, MIMICS, Invivo, or Dolphin. But these tools are generally limited in their capabilities and extensibility, and they often have relatively poor performance.  In the open source community, similar projects include scikit-image, ImageJ, and OpenCV. These projects vary in their technology stack, and each project has strengths in particular types of algorithms, but they have been working together with the leaders in these communities—in particular, Stefan van der Walt in the scikit-image community and Curtis Reuden in the ImageJ community—to improve collaboration between these open source projects. Recently, great strides have been made in the ImageJ and ITK projects to improve their bridge and use of NumPy arrays. NumPy arrays are now a standard way to use data across scikit-image, ITK, ImageJ, and OpenCV. This is very exciting because it means that researchers can mix and match the algorithm implementations from ITK, ImageJ, scikit-image, or OpenCV in Python to perform reproducible research and open science.  In 2018 there was a workshop held for this purpose, and more events like that are planned for 2019.

The core of ITK is written in C++, which is helpful for performance and compatibility with a wide variety of computing hardware and operating systems.  ITK is multi-threaded, templated over spatial dimensions, and pixel types to support processing in N dimensions and allows for compile-time optimizations. The upcoming version of ITK can be used on the standard x86-64 architecture and Linux / macOS / Windows operating systems, but it can be built for other architectures like ARM and POWERPC too, so it can be used on mobile phones or in high-performance computers. C++ portability is possibly thanks to CMake, which is one of the most popular cross-platform C++ build system in use today. It is worth noting that the open source CMake project, now widely used by hundreds of millions of C++ developers for various projects, was originally started to support cross-platform builds of ITK.  ITK has Python bindings. Binary Python packages across all major platforms are available on PyPI and conda-forge. Bridges are available for core ITK data structures, like ITK's Image data structure; to convert them to and from NumPy arrays; and for NumPy array views.  A JavaScript tooling project called `itk.js`, is now under development as well. itk.js supports WebAssembly builds of ITK and other C++ code, so it can perform advanced spatial analysis directly in the web browser.

ITK was started in 1999 by Dr. Terry Yoo, a Project Manager at the National Library of Medicine for the Visible Human Project. Terry Yoo is a strong advocate for open science, so from the project's beginnings an expectation was started to operate according to the principles of open science: open source, open data, and open access to literature. Project participants such as Will Schroeder from Kitware, Luis Ibanez and Stephen Aylward (formerly of the University of North Carolina at Chapel Hill, now at Kitware), Bill Lorensen from GE Corporate Research, Ross Whitaker from Utah, and many more, were strong advocates for open science because of the need for reproducible research. Literally hundreds of researchers have worked together to contribute to the project and the principles of reproducible research. Today, ITK continues to operate as a vibrant, community-driven project that seeks to advance the practice of image analysis through open science. 

Kitware and the Community are currently the maintainers for this project. ITK is developed on GitHub in an open way and with professional practices that produce high-quality software. Continuous integration testing and code reviews ensure code is generalizable, scalable, fast, reliable, and able to work across platforms. Extensive documentation is available for the toolkit. The community communicates through the Discourse discussion forum and mailing list at [discourse.itk.org](discourse.itk.org). At Kitware, we use and support ITK, since it allows us to work for our customers better. The community supports ITK for a similar reason: its flexible integration of state-of-the-art algorithms in well-maintained software.

Users and contributors vary from university researchers, to government laboratories, to commercial companies. If you look at the work published at the Medical Image Computing and Computer Assisted Intervention conference (MICCAI), which is among the largest and most well-respected image analysis conferences, most of it uses ITK in some form. ITK has an Apache 2.0 open source license, which is friendly to commercial development, and allows it to be used in the development of commercial projects too. Kitware uses ITK, for example, to help medical device manufacturers develop software for their devices. 

General community governance of ITK is provided by the Insight Software Consortium.
The Insight Software Consortium (ISC) is a non-profit, educational consortium dedicated to promoting and maintaining open source, and promotes freely available software for medical image analysis. The ISC, among other things, holds the copyright to ITK.  ISC always keeps diversity in mind, as is evident in its newly elected board members Bea, Ipek, and Lauren. Each is an individual that has worked toward increasing the participation of women in scientific computing in various ways.  For example, Beatriz participates in events that encourage STEM training at early stages as well as careers in open source development. Women developers are essential for the continued growth of the open source community.  For example, the [Harvard Business Review](https://hbr.org/2018/07/in-collaborative-work-cultures-women-carry-more-of-the-weight) had an article last year that talked about how women are generally more prone to be team players in collaborative job environments. ITK could benefit immensely from these programmers, female developers are wanted and needed!


### Demo

* [Demo at timestamp 19:52](https://youtu.be/o_X-4EbLolY?t=1192)
ITK interactive 
* [Binder demo](https://mybinder.org/v2/gh/thewtex/OpenSourceDirectionsPodcastITKDemo/master?filepath=OpenSourceDirectionsPodcastITKDemo.ipynb)

### Roadmap Discussion

ITK is moving to showcase scenarios to the medical and scientific communities that they can relate to. An example of this is the application from the demo section of the webinar.  This community has a long history of advancing the cause of reproducibility and it is intended for ITK to be recognized as a leader in accessibility soon. 

In practice, this means developing tools like the `itk-jupyter-widgets`. Jupyter is a wonderful tool for teaching and exploring computational methods. The itk-jupyter-widgets bring together ITK and the accessibility of Python and Jupyter. 3D interactivity means that users can gain insights into the data and how algorithms and their parameters interact with the data. While the itk-jupyter-widgets support ITK images, they also support other data types like NumPy arrays, Dask arrays, ImageJ buffers, and VTK images. WebAssembly 2 would be even another quicker step to understand how a computational method is working without installing any software at all.  Users could just go to a webpage and interact with the data, see what it means, and understand the effects of the algorithms being used.  There are definitely some tradeoffs that need to be handled here because not everyone has access to stable high-speed internet connections.  Internet access is something that has been dealt with a lot, especially with the Jupyter widgets.  Sometimes in these scenarios the servers can end up being a huge bottleneck to the data workflow.  Aside from reducing the amount of data streaming, WebAssembly has also been helpful for allowing data processing when the datasets are stored locally because then the browser can just process that data locally.

In the future, the plan is to expand on the widgets to support other data types like point sets and segmentation surfaces.  There is some anticipation for more examples of ITK that are accessible through MyBinder-hosted Jupyter notebooks. In addition, we will open new frontiers in knowledge sharing for computational image analysis methods with interactive examples. We will help students learn how algorithms work by interactively running them through the WebAssembly capabilities of the modern web browser. `itk.js` enables the generation of WebAssembly, and `vtk.js` (the browser-native version of the Visualization Toolkit), enables rendering the result.  

Talking about the future of ITK, it is important to mention the next major release of ITK, ITK 5. It is currently in release candidate phase. ITK 5 is a major upgrade to the toolkit. The entire codebase (over 1.7 million lines of code) was modernized in style and updated to modern C++, multi-threading underwent a major refactoring, and there are now three different threading backends available.  Some of the new backends include a native thread pool and threading based on Intel Threading-Building-Blocks (TBB). It is also much easier to write multi-threaded code in ITK 5. In addition, ITK 5 will feature drastic improvements to the Python API and Python coverage in the toolkit. For example, a more procedural, snake case API is available for filters, and we will be able to use point sets, meshes, and spatial objects, in addition to images, in Python.  Even with all these exciting updates it is still anticipated that the most interesting developments will come from the community. 

[This build](https://discourse.itk.org/t/itk-5-0-alpha-2-performance/959) is available for people to test out and provide feedback to help with making it into a final release.  It is very exciting to see what the next community member, who wants to make a big impact, will bring to the table. To make it easier to distribute new algorithms developed within ITK's architecture, there is now a Python cookie-cutter template that scaffolds out the module infrastructure for a new ITK filter. Recently, the team added infrastructure to automatically configure continuous integration testing and continuous deployment of Python packages for ITK modules developed on GitHub. They can't wait to see the innovative developments the community will create! 

### Viewer Questions

**Q.** Any interesting module contributed lately to ITK by the community?

**A.**  Yes, there are.  I can note one specifically that was contributed by Pablo.  We have a very exciting Wavelet module that is a processing and filtering module for images.  This should help attract a lot of potential signal processing customers.  Wavelets are just an effective mechanism for detecting artifacts in images.  

One of the most interesting ones I have seen is the reconstruction toolkit.  This was an open source project based on ITK which has been around for many years now.  They now have Python packages and it has algorithms for reconstructing computer tomography images.  Tomography images are where you have a projection in different planes and then you reconstruct the image based upon those projections.  It uses compress sensing iterative algorithms that are very powerful in that module.

---

**Q.** How well are ITK and VTK aligned in terms of compatibility, integration (i.e. installed together via pip) and will this change / improve in the future?

**A.**  ITK works very well with VTK, the visualization toolkit, they have a history of being developed together.  Python packages for the visualization toolkit have recently been developed and deployed in Conda and PyPi.  In the near future we are looking at distributing Python packages for the bridge.  There is a bridge between VTK and ITK that allows you to convert data structures from one to the other.  There are some Alpha-Beta quality packages out there on PyPi right now that are improving, and over the next few months we’re hoping to harden those a bit.  They are written for Windows and Linux but Mac is coming.  Those packages allow you to create pipelines and process images with ITK and then visualize them with VTK.

---

**Q.** I thought ITK was for image processing only, what is used for the visualization part of the widget?

**A.**  The visualization is happening in your web browser with the Jupyter widgets and that is happening through the WebGL technology.  IT actually accesses your GPU through the browser so that is why it is so fast and responsive and 3D.  The library that it is built on is called vtk.js which is a port of the visualization toolkit into JavaScript and WebGL.

---

**Q.**  When processing the 3D images with various image processing algorithms, is there a risk of producing computational artifacts to the visualized image that could be misinterpreted by a viewer?

**A.** That really comes down to a research design question.  You need to really understand what the algorithms will do to your image, and what your inputs and outputs are.  One thing that could help here is going into ITK knowing what the algorithm does that you are running.   Additionally if you run the algorithm and notice that the outputs and inputs don’t match your expectations then that is a good opportunity to contribute to the documentation.  There is always the risk that the user misinterprets the results, but there are precautions in place to help avoid this.  When it is being used by medical professionals it is sent through software review and many steps are taken before the final conclusions are drawn.  Yes it is possible that someone could misunderstand their results, but thanks to the user support there is a small margin for that.

---


**Q.**  Pablo talk about module contribution, how easy can user contribute their ITK module and have it "pip installable"?

**A.** As was kind of discussed before, there is a cookie cutter where you basically run two Python commands that will create a folder which has everything you need to create a GitHub repository.  Soon you will just enable out of your pipelines and the output will be Python packages that are automatically pushed to GitHub review states and the Python package index.  You can do that on your own and we encourage everyone to ask on the discourse forum and become part of the Insight Software Consortium, which is where the community gathers and we put these repos together.  After you create a module that has your functionality in it and classes that you have developed, we can create a pointer to that in the main repository and make a file that allows you to see anyone who downloads the main toolkit.  They will also get the option to enable your module in their build.  This is sort of the way that these modules are integrated from the community into the main toolkit.

---
**Q.**  Are there tools in ITK for visualizing tensor fields?

**A.** ITK supports scientific images, so these are not your 8-bit RGB images you would take with a camera.  It supports many cooler things like multi-component images, which can take vectors and may contain tensors.  Right now the Jupyter widgets, for example, just support scalar valued images but in the future they may support tensor valued images, so multiple components.  There’s issues out there to hopefully add multiple components in the future, and if you want to look at tensors, then a first rate tensor is like a vector where a second rate tensor is like a diffusion tester.  There are other tools out there in the ITK community, it is a very broad community, for example I think [3D Slicer](https://www.slicer.org/) is an application that supports ITK.  

### Footnotes & Links

* List of community channels [here](https://itk.org/Wiki/ITK/Community)
* [ITK Website](https://itk.org/)
* [GitHub page](https://github.com/InsightSoftwareConsortium/ITK)
* [Discourse forum](discourse.itk.org)

